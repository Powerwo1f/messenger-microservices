# üìå –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É Messenger Gateway (gRPC + Fastify)

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
- –ù–∞—Å—Ç—Ä–æ–µ–Ω `gateway/src/main.ts` –Ω–∞ Fastify
- –°–æ–∑–¥–∞–Ω `auth.proto`
- –ù–∞–ø–∏—Å–∞–Ω gRPC –∫–ª–∏–µ–Ω—Ç –¥–ª—è `AuthService`
- –°–¥–µ–ª–∞–Ω –±–∞–∑–æ–≤—ã–π `POST /login` –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç gRPC

---

## üß± –ë–ª–∏–∂–∞–π—à–∏–µ —à–∞–≥–∏

### MAIN: üìÅ –°–¥–µ–ª–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ auth —Å–µ—Ä–≤–∏—Å–µ —á–µ—Ä–µ–∑ gateway

### 1. üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å gateway:
```
gateway/
‚îú‚îÄ‚îÄ proto/                # .proto —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts           # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Fastify
‚îÇ   ‚îú‚îÄ‚îÄ controllers/      # REST –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ grpc-clients/     # –æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ gRPC –∫–ª–∏–µ–Ω—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/      # auth/session middleware (–≤ –±—É–¥—É—â–µ–º)
‚îÇ   ‚îî‚îÄ‚îÄ routes/           # —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
```

---

### 2. üîê –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Auth –ª–æ–≥–∏–∫–∏
- [ ] `POST /register` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç gRPC `authService.register`
- [ ] `GET /me` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `authService.getMe`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cookie-—Å–µ—Å—Å–∏—é –∏–ª–∏ JWT (–≤—Ä–µ–º–µ–Ω–Ω—ã–π `token.user` –æ–±—ä–µ–∫—Ç –ø–æ–∫–∞ –º–æ–∂–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å)

---

### 3. üß™ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è TypeScript gRPC –∫–ª–∏–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü–æ–∑–∂–µ –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π gRPC –∫–ª–∏–µ–Ω—Ç:
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@grpc/grpc-js` + `@grpc/proto-loader`
- [ ] –ò–ª–∏ `grpc-tools` + `ts-proto` (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ TS-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)

---

### 4. üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ `.proto` –∏ gRPC –∫–ª–∏–µ–Ω—Ç—ã:
- [ ] `user.proto` (gRPC getUserById, updateUser)
- [ ] `chat.proto` (—Å–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤)
- [ ] `message.proto` (–æ—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π)

---

### 5. üß∞ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- [ ] `tsconfig.json` ‚Üí –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å rootDir = "src", outDir = "dist"
- [ ] –°–æ–∑–¥–∞—Ç—å `Dockerfile` –¥–ª—è gateway
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `docker-compose.yml` —Å–æ –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ + Redis + Postgres

---

### 6. üß† –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –°–æ–∑–¥–∞—Ç—å `README.md` –≤ gateway —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–ø—É—Å–∫–∞, gRPC –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ä–æ—É—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å Swagger/OpenAPI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –ª–æ–≥–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

## üèÅ –¶–µ–ª—å –±–ª–∏–∂–∞–π—à–µ–≥–æ —ç—Ç–∞–ø–∞:
–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á–∏–π gateway, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π:
- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ gRPC
- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –∑–∞—â–∏—Ç—É `/me` —á–µ—Ä–µ–∑ –∫—É–∫—É/—Ç–æ–∫–µ–Ω

> *–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /register` —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ `authService.register` –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å `authService` —Å–µ—Ä–≤–µ—Ä–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `Login` –∏ `Register`.*